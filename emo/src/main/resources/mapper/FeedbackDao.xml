<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dadaepo.emo.dao.FeedbackDao">
    <insert id="insertReaction" parameterType="com.dadaepo.emo.dto.feedback.ReactionRequest">
        INSERT INTO feedback(
            member_id
            , memo_id
            , reaction
        )
        VALUES(
            #{memberId}
            , #{memoId}
            , #{reaction}
        )
    </insert>
    <select id="selectReactions" resultType="com.dadaepo.emo.dto.feedback.ReactionInfo">
        SELECT reaction
        , profile_photo_url AS photoURl
        , name
        , nickname
        FROM feedback
        INNER JOIN member
            ON feedback.member_id = member.id
        WHERE memo_id = #{memoId}
    </select>
    <select id="selectCountReactionByType" resultType="int">
        SELECT COUNT(*)
        FROM feedback
        WHERE memo_id = #{memoId}
        GROUP BY reaction
    </select>
</mapper>
